<!doctype html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <title>ë¦¬ë·° ë…¸íŠ¸</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    </head>
    <body class="bg-gray-100 font-sans">
        <div class="max-w-3xl mx-auto py-10">
            <h1 class="text-3xl font-bold mb-4 text-center">
                ğŸ“˜ ì±…/ì˜í™” ë¦¬ë·° ë…¸íŠ¸
            </h1>
            <p class="text-lg text-center mb-6">
                â­ í‰ê·  ë³„ì :
                <span class="font-semibold" id="score_avg"></span>
            </p>

            <div class="text-center mb-6">
                <a
                    href="{{ url_for('edit') }}"
                    class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                >
                    ìƒˆ ë¦¬ë·° ì‘ì„±
                </a>
            </div>

            <div class="space-y-4" id="reviewList">
                <p class="text-center text-gray-500">
                    ì•„ì§ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ë¦¬ë·°ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”!
                </p>
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", loadReviews);

            let score = 0;

            function loadReviews() {
                axios
                    .get("/reviews")   // â˜… ë¦¬ë·° ëª©ë¡ API
                    .then(function (response) {
                        const reviews = response.data;
                        const reviewList = document.getElementById("reviewList");
                        reviewList.innerHTML = "";

                        if (reviews.length === 0) {
                            const div = document.createElement("p");
                            div.className = "text-center text-gray-500";
                            div.innerText = "ì•„ì§ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ë¦¬ë·°ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”!";
                            reviewList.appendChild(div);
                            return;
                        }

                        reviews.reverse().forEach((review) => {
                            const div = document.createElement("div");
                            div.className = "bg-white shadow p-4 rounded";

                            div.innerHTML = `
                                <h2 class="text-xl font-semibold">${review.title}</h2>
                                <p class="text-gray-700 mt-2">${review.contents}</p>
                                <p class="mt-2">â­ ${review.score}</p>
                                <div class="mt-3 space-x-3">
                                    <a href="/edit/${review.id}" class="text-blue-500 hover:underline">ìˆ˜ì •</a>
                                    <a href="javascript:void(0)" onclick="deleteReview(${review.id})" class="text-red-500 hover:underline">ì‚­ì œ</a>
                                </div>
                            `;

                            score += Number(`${review.score}`);
                            reviewList.appendChild(div);
                        });

                        document.querySelector('#score_avg').innerText = (score / reviews.length).toFixed(1);

                    })
                    .catch(function (error) {
                        console.error(error);
                    });
            }

            function deleteReview(id) {
                if (confirm("ë¦¬ë·°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                  axios
                    .delete("/review/" + id)
                    .then(function (response) {
                      console.log(response);
                      loadReviews();
                    })
                    .catch(function (error) {
                      console.error(error);
                    });
                }
              }
        </script>
    </body>
</html>